import os
import pickle

import numpy as np

terminal_states_dict = {
    2: [[4, 4], [2, 2], [1, 2], [1, 3], [2, 3], [2, 1]],
    3: [[4, 4, 4], [2, 2, 2], [3, 1, 3], [3, 1, 1], [2, 3, 3], [1, 2, 2]],
    4: [[4, 4, 4, 4], [2, 2, 2, 2], [1, 3, 2, 3], [3, 1, 3, 2], [2, 3, 2, 1], [2, 2, 3, 1]],
    5: [[4, 4, 4, 4, 4], [2, 2, 2, 2, 2], [2, 1, 3, 3, 1], [1, 2, 1, 2, 1], [2, 2, 3, 1, 3], [2, 1, 1, 1, 1]],
    6: [[4, 4, 4, 4, 4, 4], [2, 2, 2, 2, 2, 2], [3, 2, 3, 1, 3, 1], [2, 1, 1, 2, 1, 2], [3, 1, 2, 2, 3, 3],
        [2, 1, 1, 3, 3, 1]],
    7: [[4, 4, 4, 4, 4, 4, 4], [2, 2, 2, 2, 2, 2, 2], [3, 2, 2, 2, 1, 3, 2], [2, 1, 3, 1, 3, 2, 1],
        [3, 2, 3, 1, 2, 3, 2], [2, 2, 3, 1, 2, 2, 1]],
    8: [[4, 4, 4, 4, 4, 4, 4, 4], [2, 2, 2, 2, 2, 2, 2, 2], [1, 3, 3, 3, 3, 3, 3, 1], [2, 2, 1, 2, 2, 1, 2, 1],
        [1, 2, 1, 1, 3, 2, 1, 1], [1, 2, 2, 3, 1, 2, 3, 1]],
    9: [[4, 4, 4, 4, 4, 4, 4, 4, 4], [2, 2, 2, 2, 2, 2, 2, 2, 2], [2, 3, 3, 1, 2, 2, 3, 3, 2],
        [3, 3, 1, 1, 3, 3, 2, 1, 3], [2, 2, 1, 1, 2, 3, 1, 3, 3], [3, 2, 2, 3, 1, 3, 2, 1, 2]],
    10: [[4, 4, 4, 4, 4, 4, 4, 4, 4, 4], [2, 2, 2, 2, 2, 2, 2, 2, 2, 2], [1, 2, 3, 2, 3, 2, 2, 1, 2, 1],
         [2, 1, 2, 1, 3, 3, 2, 3, 3, 3], [2, 1, 3, 1, 1, 3, 3, 2, 3, 2], [1, 1, 1, 1, 2, 3, 2, 3, 2, 2]],
    11: [[4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4], [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2], [1, 3, 2, 3, 2, 2, 3, 3, 3, 3, 2],
         [1, 2, 1, 2, 2, 2, 2, 3, 3, 2, 3], [2, 3, 1, 3, 2, 2, 1, 2, 2, 3, 1], [3, 2, 2, 2, 3, 1, 1, 2, 3, 2, 2]]
}


def load_transitions(path):
    batch_files = [f for f in os.listdir(path) if f.startswith("transitions_batch_") and f.endswith(".pkl")]
    batch_files.sort(key=lambda x: int(x.rsplit('_', 1)[-1].split('.')[0]))
    transitions = [transition for batch_file in batch_files
                   for transition in pickle.load(open(os.path.join(path, batch_file), 'rb'))]

    return np.array(transitions, dtype=object)
